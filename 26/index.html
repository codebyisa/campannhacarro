<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2easy Insurance - Auto Insurance Quote</title>
  <link rel="stylesheet" href="/css/style.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.min.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDAfJRN4bVcnOls0G8CzqaAOoeCOYD4V9s&libraries=places" async defer></script>

  <!-- Meta Pixel Code -->
  <script>
    !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1413601500284459');
    fbq('track', 'PageView');
  </script>
  <noscript>
    <img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1413601500284459&ev=PageView&noscript=1"/>
  </noscript>
  <!-- End Meta Pixel Code -->

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-TS9ZJ8Q9');</script>
  <!-- End Google Tag Manager -->
</head>

<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TS9ZJ8Q9"
    height="0" width="0" style="display:none;visibility:hidden"></iframe>
  </noscript>
  <!-- End Google Tag Manager (noscript) -->

  <header class="header">
    <img src="https://portal.2easyinsurance.com/wp-content/uploads/2024/04/logotipo-2easy-obamacare.png" alt="2easy Logo" class="header-logo">
  </header>
  
  <section class="calc-section" id="cotacao">
    <div class="calc-container">
      <div class="calc-right">
        <h2 class="calc-title">Get your quote.</h2>
        <p class="calc-subtitle">Receive your personalized quote<br> in just a few minutes.</p>
        <br><br>

        <div class="calc-form-container">
          <form id="autoForm">
            <!-- STEP 1 -->
            <div class="form-step active" data-step="1">
              <div class="form-group">
                <label>ZIP Code</label>
                <input type="text" name="zip" id="zip" required>
              </div>
              <div class="form-group">
                <label>State</label>
                <input type="text" name="state" id="state" required>
              </div>
              <div class="form-group">
                <label>Street number and name</label>
                <input type="text" name="address" id="address" required>
              </div>
              <div class="form-group">
                <label>Full name (main driver)</label>
                <input type="text" name="main_driver_name" required>
              </div>
              <div class="form-group">
                <label>Date of birth</label>
                <input type="date" name="main_driver_dob" required>
              </div>
              <div class="form-group">
                <label>Phone</label>
                <input type="text" name="phone" required>
              </div>
              <div class="form-group">
                <label>Do you have a U.S. Driver's License?</label>
                <div class="checkbox-group">
                  <label><input type="radio" name="has_license" value="yes" required> Yes</label>
                  <label><input type="radio" name="has_license" value="no"> No</label>
                </div>
              </div>
              <button type="button" onclick="nextStep()">Next</button>
            </div>

            <!-- STEP 2 -->
            <div class="form-step" data-step="2">
              <div class="form-group">
                <label>Additional drivers</label>
                <div id="additionalDrivers"></div>
                <span class="add-link" onclick="addAdditionalDriver()">+ Add additional driver</span>
              </div>
              <button type="button" onclick="prevStep()">Back</button>
              <button type="button" onclick="nextStep()">Next</button>
            </div>

            <!-- STEP 3 -->
            <div class="form-step" data-step="3">
              <div class="form-group">
                <label>Do you have your vehicle's VIN?</label>
                <div class="checkbox-group">
                  <label><input type="radio" name="vin_option" value="yes" required> ‚úÖ Yes, I want to enter the VIN</label>
                  <label><input type="radio" name="vin_option" value="no"> üìã No, I want to select by model</label>
                </div>
              </div>

              <div id="vin-section" style="display:none;">
                <div class="form-group">
                  <label>Enter the vehicle VIN</label>
                  <input type="text" name="vehicle_main" id="vehicle_main" maxlength="17" autocomplete="off" pattern="[A-HJ-NPR-Za-hj-npr-z0-9]{17}">
                  <span id="vin-error" style="display:none;color:#E53935;font-size:0.97em;margin-top:2px;"></span>
                  <p style="background:#ff6b00ad;border-radius:8px;padding:20px;color:#000;font-size:0.8em;margin-top:10px;">
                    Important: The VIN has 17 characters and can be found on the vehicle title, registration, or etched into the vehicle.
                  </p>
                </div>
              </div>

              <div id="model-section" style="display:none;">
                <div class="form-group">
                  <label>Year</label>
                  <select id="yearSelect" name="vehicle_year">
                    <option value="">Select year</option>
                  </select>
                </div>

                <div class="form-group">
                  <label>Make</label>
                  <select id="makeSelect" name="vehicle_make" disabled>
                    <option value="">Select make</option>
                  </select>
                </div>

                <div class="form-group">
                  <label>Model</label>
                  <select id="modelSelect" name="vehicle_model" disabled>
                    <option value="">Select model</option>
                  </select>
                  <div id="model-msg" style="display:none;color:#E53935;font-size:0.95em;margin-top:6px;"></div>
                </div>
              </div>

              <div class="form-group">
                <div id="additionalVehicles"></div>
                <span class="add-link" onclick="addAdditionalVehicle()">+ Add another vehicle</span>
              </div>

              <button type="button" onclick="prevStep()">Back</button>
              <button type="button" onclick="nextStep()">Next</button>
            </div>

            <!-- STEP 4 -->
            <div class="form-step" data-step="4">
              <div class="form-group">
                <label>Do you currently have auto insurance?</label>
                <div class="checkbox-group">
                  <label><input type="radio" name="has_insurance" value="yes" required> Yes</label>
                  <label><input type="radio" name="has_insurance" value="no"> No</label>
                </div>
              </div>
              <div class="form-group">
                <label>Email for contact</label>
                <input type="email" name="email" required>
              </div>
              <button type="button" onclick="prevStep()">Back</button>
              <button type="button" onclick="showSummary()">Next</button>
            </div>

            <!-- STEP 5 -->
            <div class="form-step" data-step="5">
              <div class="form-group">
                <label>Summary of information:</label>
                <div class="summary" id="summaryBox"></div>
              </div>
              <button type="button" onclick="prevStep()">Back</button>
              <button type="submit">Submit Quote</button>
            </div>
          </form>
        </div>

        <div id="modal-success" style="display:none; position:fixed; inset:0; background:rgba(32,32,32,0.55); z-index:9999; align-items:center; justify-content:center;">
          <div style="background:#fff; padding:38px 32px 30px 32px; border-radius:20px; max-width:400px; text-align:center; box-shadow:0 12px 32px rgba(0,0,0,0.17);
          position:relative;">
            <svg width="54" height="54" fill="none" style="margin-bottom:18px;"><circle cx="27" cy="27" r="27" fill="#04cc8c"/><path d="M16 27l9 9 13-13" stroke="#fff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <h2 style="color:#04cc8c; font-size:1.28rem; margin-bottom:6px;">Quote sent successfully!</h2>
            <p style="color:#444; font-size:1.03rem;">Your quote is now in our system!<br>You will receive the full quote within 5 minutes by email.<br>If you don‚Äôt see it, check your SPAM folder.</p>
            <button onclick="closeSuccessModal()" style="margin-top:20px; padding:12px 30px; background:#04cc8c; color:#fff; border:none; border-radius:8px; font-weight:600; font-size:1.09rem; cursor:pointer;">OK</button>
          </div>
        </div>

      </div>
    </div>
  </section>

  
  <section class="porque-section">
    <div class="porque-container">
      <div class="porque-image">
        <img src="https://portal.2easyinsurance.com/wp-content/uploads/2025/11/Titulo-2.png" alt="Why choose 2Easy?">
      </div>

      <div class="porque-content">
        <h2>Why get your car insurance with 2Easy?</h2>

        <p class="subtitle">
          <strong>You choose what you want to protect.</strong><br>
          We take care of the rest.
        </p>

        <ul class="checklist">
          <li>‚úîÔ∏è Liability coverage in all states</li>
          <li>‚úîÔ∏è Protection against collision, theft and vandalism</li>
          <li>‚úîÔ∏è 24/7 roadside assistance (tow, breakdown, tire change, etc.)</li>
          <li>‚úîÔ∏è Rental car in case of an accident</li>
          <li>‚úîÔ∏è No-obligation quote directly via WhatsApp</li>
        </ul>

        <button class="cta2"><a href="#cotacao">Get my quote!</a></button>
      </div>
    </div>
  </section>


  <section class="hero">
    <div class="hero-content">
      <p class="tag">üöó Drive with peace of mind <span>in the USA!</span></p>

      <h1>Get Your Auto Insurance Quote Now</h1>

      <p class="sub-text">fast, easy, and hassle-free.</p>

      <p class="description">
        Complete protection against collisions, theft, vandalism, liability, and 24/7 assistance.<br>
        Receive your quote in just a few minutes!
      </p>

      <button class="cta"><a href="#cotacao">Get my quote!</a></button>
    </div>

    <div class="hero-empty"></div>
  </section>


  <section class="testimonial-section" style="padding:100px 20px; background:#198b84; text-align:center; color:#fff;">
    <div class="testimonial-inner" style="max-width:900px; margin:0 auto;">
      <p style="font-size:26px; line-height:1.4; font-weight:300; margin-bottom:40px;">
        ‚ÄúI got my insurance with 2Easy in just 10 minutes on WhatsApp! Clear information, fast service, and great support.‚Äù
      </p>
      <div style="display:flex; align-items:center; justify-content:center; gap:14px;">
        <img src="https://portal.2easyinsurance.com/wp-content/uploads/2025/07/ChatGPT-Image-Jul-23-2025-10_13_16-AM.png" style="width:52px; height:52px; object-fit:cover; border-radius:50%;" />
        <div style="text-align:left;">
          <h4 style="margin:0; font-size:18px; font-weight:700;">Fernanda</h4>
          <span style="font-size:14px; opacity:0.8;">Miami-FL</span>
        </div>
      </div>
    </div>
  </section>

  <section class="como-funciona" style="padding:110px 20px; background:url('https://portal.2easyinsurance.com/wp-content/uploads/2025/07/Boost-Your-Car-Insurance.jpg') no-repeat center/cover; text-align:center; position:relative;">
    <div style="position:absolute; inset:0; background:rgba(40, 5, 72, 0.923);"></div>

    <div style="position:relative; max-width:900px; margin:0 auto; color:#fff;">
      <h2 style="font-size:38px; font-weight:800; margin-bottom:25px; text-transform:uppercase;">
        How does car insurance <span style="color:#00ff90;">work?</span>
      </h2>

      <p style="font-size:20px; line-height:1.5; max-width:800px; margin:0 auto 40px auto;">
        Auto insurance provides protection against theft, collisions, liability to third parties, and unexpected incidents on the road.
        You can include rental car coverage, 24/7 assistance, and comprehensive coverage for natural disasters like hail or floods.
      </p>

      <a href="#cotacao" style="display:inline-block; padding:16px 36px; background:#06c167; border-radius:30px; color:#fff; font-size:18px; font-weight:700; text-decoration:none;">
        Get my quote!
      </a>
    </div>
  </section>

  <section class="faq">
    <h2 class="faq-title">Frequently Asked Questions</h2>

    <div class="faq-item">
      <input type="checkbox" id="faq1" checked>
      <label for="faq1" class="faq-question"><span class="icon"></span>What is auto insurance?</label>
      <div class="faq-answer">
        Auto insurance provides financial protection against vehicle damage, theft, and liability for third-party injuries or property damage.
        It may include 24/7 assistance, rental coverage, and comprehensive protection.
      </div>
    </div>

    <div class="faq-item">
      <input type="checkbox" id="faq2">
      <label for="faq2" class="faq-question"><span class="icon"></span>What types of coverage are available?</label>
      <div class="faq-answer">
        The main coverage types include:<br><br>
        <strong>Collision:</strong> Covers your vehicle in accidents.<br>
        <strong>Theft and vandalism:</strong> Protects against theft and intentional damage.<br>
        <strong>Liability:</strong> Covers third-party damages and injuries.<br>
        <strong>Comprehensive:</strong> Covers non-collision events like fires, weather damage, etc.<br>
        <strong>24/7 assistance:</strong> Tow, tire change, mechanical help.<br>
        <strong>Rental car:</strong> Provides a temporary replacement vehicle.
      </div>
    </div>

    <div class="faq-item">
      <input type="checkbox" id="faq3">
      <label for="faq3" class="faq-question"><span class="icon"></span>Is auto insurance mandatory?</label>
      <div class="faq-answer">
        In some states, like Florida, certain coverages are mandatory. This usually includes liability insurance.
        Requirements vary by state.
      </div>
    </div>

    <div class="faq-item">
      <input type="checkbox" id="faq4">
      <label for="faq4" class="faq-question"><span class="icon"></span>Does auto insurance cover natural disasters?</label>
      <div class="faq-answer">
        Yes, comprehensive coverage usually protects against weather-related damage such as hail.
        Check your policy details for specifics.
      </div>
    </div>

    <div class="faq-item">
      <input type="checkbox" id="faq5">
      <label for="faq5" class="faq-question"><span class="icon"></span>Is liability coverage valid in other states?</label>
      <div class="faq-answer">
        Yes, liability coverage is typically valid nationwide, but it's important to confirm policy details in each state you plan to drive.
      </div>
    </div>
  </section>

  <section class="cta-section">
    <div class="cta-grid">
      <div class="cta-left">
        <h2>
          Don't wait for an emergency to protect yourself.<br>
          Get your quote now ‚Üí <span class="green">it's fast, free, and with no obligation!</span>
        </h2>
      </div>

      <div class="cta-right">
        <a href="#cotacao" class="cta-btn">Get my quote!</a>
      </div>
    </div>
  </section>

  <footer class="footer">
    <div class="footer-container">
      <img src="https://portal.2easyinsurance.com/wp-content/uploads/2025/10/logo2easy.png" class="footer-logo">

      <div class="footer-right">
        <div class="footer-contact">
          <p>
            <i class="icon fa-solid fa-envelope"></i>
            <a href="mailto:info@2easyinsurance.com">info@2easyinsurance.com</a>
            &nbsp;&nbsp;&nbsp;
            <i class="icon fa-brands fa-whatsapp"></i>
            <a href="tel:+13213441199">+1 (321) 344-1199</a>
          </p>

          <p>6735 Conroy Road, Suite 413, Orlando, FL 32835, USA</p>
        </div>

        <div class="footer-social">
          <a href="https://www.youtube.com/channel/UC0L-vusX3XR4aNFg_iClHUQ" class="social-icon" target="_blank"><i class="fa-brands fa-youtube"></i></a>
          <a href="https://br.linkedin.com/company/2easyinsurance/" class="social-icon" target="_blank"><i class="fa-brands fa-linkedin-in"></i></a>
          <a href="https://www.facebook.com/2easyinsuranceusa" class="social-icon" target="_blank"><i class="fa-brands fa-facebook-f"></i></a>
          <a href="https://instagram.com/2easyinsurance.pt/" class="social-icon" target="_blank"><i class="fa-brands fa-instagram"></i></a>
        </div>
      </div>
    </div>

    <div class="footer-divider"></div>

    <p class="footer-copy">Copyright ¬© 2024 2EasyInsurance. All rights reserved.</p>
  </footer>

  <script>

document.addEventListener("DOMContentLoaded", function(){
  // TELEFONE - BANDEIRINHA E M√ÅSCARA
  const phoneInput = document.querySelector('input[name="phone"]');
  let itiInstance = null;
  if (phoneInput) {
    const iti = window.intlTelInput(phoneInput, {
      initialCountry: "us",
      preferredCountries: ["us", "br"],
      nationalMode: false,
      separateDialCode: true,
      formatOnDisplay: true,
      utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js"
    });
    itiInstance = iti;

    function applyPhoneMask() {
      var country = iti.getSelectedCountryData().iso2;
      $(phoneInput).unmask();
      if (country === "us") {
        $(phoneInput).mask('(000) 000-0000');
      } else if (country === "br") {
        $(phoneInput).mask('00 00000-0000');
      } else {
        $(phoneInput).unmask();
      }
    }
    applyPhoneMask();
    phoneInput.addEventListener("countrychange", applyPhoneMask);
  }

  // FORM MULTISTEP
  let currentStep = 1;
  let driverCount = 0;
  let vehicleCount = 0;

  window.nextStep = function() {
    if (!validateStep()) return;
    const current = document.querySelector(`.form-step[data-step="${currentStep}"]`);
    const next = document.querySelector(`.form-step[data-step="${currentStep + 1}"]`);
    if (current && next) {
      current.classList.remove("active");
      next.classList.add("active");
      currentStep++;
    }
  }
  window.prevStep = function() {
    const current = document.querySelector(`.form-step[data-step="${currentStep}"]`);
    const prev = document.querySelector(`.form-step[data-step="${currentStep - 1}"]`);
    if (current && prev) {
      current.classList.remove("active");
      prev.classList.add("active");
      currentStep--;
    }
  }

  // ========== VIN VALIDATION ==========
  function isValidVIN(vin) {
    vin = vin.toUpperCase();
    if (!/^[A-HJ-NPR-Z0-9]{17}$/.test(vin)) return false;
    const map = {
      A:1, B:2, C:3, D:4, E:5, F:6, G:7, H:8,
      J:1, K:2, L:3, M:4, N:5, P:7, R:9, S:2,
      T:3, U:4, V:5, W:6, X:7, Y:8, Z:9,
      '1':1, '2':2, '3':3, '4':4, '5':5, '6':6, '7':7, '8':8, '9':9, '0':0
    };
    const weights = [8,7,6,5,4,3,2,10,0,9,8,7,6,5,4,3,2];
    let sum = 0;
    for (let i = 0; i < 17; i++) { sum += map[vin.charAt(i)] * weights[i]; }
    let checkDigit = sum % 11;
    checkDigit = (checkDigit === 10) ? 'X' : checkDigit.toString();
    return vin.charAt(8) === checkDigit;
  }

  function validateAllVINs() {
    let allOk = true;
    const vinMode = (document.querySelector('input[name="vin_option"]:checked') || {}).value;

    const mainVINInput = document.getElementById('vehicle_main');
    const mainVINError = document.getElementById('vin-error');
    if (vinMode === 'sim' && mainVINInput) {
      if (mainVINInput.value.trim() === "") {
        if (mainVINError) { mainVINError.textContent = "Informe o VIN do ve√≠culo."; mainVINError.style.display = "block"; }
        mainVINInput.focus();
        allOk = false;
      } else if (!isValidVIN(mainVINInput.value.trim())) {
        if (mainVINError) { mainVINError.textContent = "O VIN informado n√£o √© v√°lido. Confira os 17 caracteres no documento do ve√≠culo."; mainVINError.style.display = "block"; }
        mainVINInput.focus();
        allOk = false;
      } else {
        if (mainVINError) mainVINError.style.display = "none";
      }
    } else {
      if (mainVINError) mainVINError.style.display = "none";
    }

    // VINs adicionais (se preencher, valida)
    document.querySelectorAll('input[name="additional_vehicle_vin[]"]').forEach(function(input){
      const errorSpan = input.parentNode.querySelector('.vin-error');
      if (input.value.trim() !== "") {
        if (!isValidVIN(input.value.trim())) {
          if (errorSpan) {
            errorSpan.textContent = "O VIN informado n√£o √© v√°lido. Confira os 17 caracteres no documento do ve√≠culo.";
            errorSpan.style.display = "block";
          }
          input.focus();
          allOk = false;
        } else {
          if (errorSpan) errorSpan.style.display = "none";
        }
      } else {
        if (errorSpan) errorSpan.style.display = "none";
      }
    });
    return allOk;
  }
// ========== ELEMENTOS VIN x MODELO ==========
const vinSection = document.getElementById('vin-section');
const modelSection = document.getElementById('model-section');
const mainVINInput = document.getElementById('vehicle_main');

const yearSelect = document.getElementById("yearSelect");
const makeSelect = document.getElementById("makeSelect");
const modelSelect = document.getElementById("modelSelect");
const modelMsg = document.getElementById("model-msg");

function setVehicleMode(mode) {
  if (mode === 'yes') {
    // VIN mode
    vinSection.style.display = 'block';
    modelSection.style.display = 'none';
    if (mainVINInput) mainVINInput.setAttribute('required', 'required');
    yearSelect.removeAttribute('required');
    makeSelect.removeAttribute('required');
    modelSelect.removeAttribute('required');
  } else if (mode === 'no') {
    // Model mode
    vinSection.style.display = 'none';
    modelSection.style.display = 'block';
    if (mainVINInput) mainVINInput.removeAttribute('required');
    yearSelect.setAttribute('required', 'required');
    makeSelect.setAttribute('required', 'required');
    modelSelect.setAttribute('required', 'required');
  }
}

document.querySelectorAll('input[name="vin_option"]').forEach(radio => {
  radio.addEventListener('change', function() {
    setVehicleMode(this.value);
  });
});

// ========== Preencher anos ==========
if (yearSelect) {
  const currentYear = new Date().getFullYear();
  for (let y = currentYear; y >= 1980; y--) {
    const opt = document.createElement("option");
    opt.value = y; opt.textContent = y;
    yearSelect.appendChild(opt);
  }
}

// ========== CACHE (localStorage) ==========
const MAKES_KEY = 'nhtsa_makes_v1';
function loadMakesCache(maxAgeMs, allowExpired = false) {
  try {
    const raw = localStorage.getItem(MAKES_KEY);
    if (!raw) return null;
    const obj = JSON.parse(raw);
    if (!obj || !Array.isArray(obj.items)) return null;
    const age = Date.now() - (obj.ts || 0);
    if (age <= maxAgeMs || allowExpired) return obj.items;
    return null;
  } catch { return null; }
}
function saveMakesCache(items) {
  try {
    localStorage.setItem(MAKES_KEY, JSON.stringify({ ts: Date.now(), items }));
  } catch {}
}

function modelsKey(make, year) { 
  return `nhtsa_models_v1_${make}|${year}`; 
}
function loadModelsCache(make, year, maxAgeMs, allowExpired = false) {
  try {
    const raw = localStorage.getItem(modelsKey(make, year));
    if (!raw) return null;
    const obj = JSON.parse(raw);
    if (!obj || !Array.isArray(obj.items)) return null;
    const age = Date.now() - (obj.ts || 0);
    if (age <= maxAgeMs || allowExpired) return obj.items;
    return null;
  } catch { return null; }
}
function saveModelsCache(make, year, items) {
  try {
    localStorage.setItem(modelsKey(make, year), JSON.stringify({ ts: Date.now(), items }));
  } catch {}
}

const MAX_AGE = 1000 * 60 * 60 * 48; // 48h

function clearSelect(sel, placeholder) {
  sel.innerHTML = "";
  const opt = document.createElement("option");
  opt.value = ""; opt.textContent = placeholder;
  sel.appendChild(opt);
}
function setLoading(sel, isLoading, loadingText = "Loading...") {
  sel.disabled = !!isLoading;
  if (isLoading) clearSelect(sel, loadingText);
}

// ========== NHTSA: carregar marcas ==========
yearSelect.addEventListener("change", async function () {
  clearSelect(makeSelect, "Select make");
  clearSelect(modelSelect, "Select model");
  modelMsg.style.display = "none";

  if (!this.value) {
    makeSelect.disabled = true;
    modelSelect.disabled = true;
    return;
  }

  const cached = loadMakesCache(MAX_AGE);
  if (cached && cached.length) {
    populateMakes(cached);
    return;
  }

  try {
    setLoading(makeSelect, true);
    const resp = await fetch(`https://vpic.nhtsa.dot.gov/api/vehicles/GetMakesForVehicleType/car?format=json`);
    const data = await resp.json();
    const names = Array.from(new Set((data.Results || [])
      .map(m => (m.MakeName || "").trim())
      .filter(Boolean)))
      .sort((a, b) => a.localeCompare(b));

    saveMakesCache(names);
    populateMakes(names);
  } catch (e) {
    const expired = loadMakesCache(MAX_AGE, true);
    if (expired && expired.length) {
      populateMakes(expired);
      modelMsg.textContent = "Unable to reach the API. Using cached makes (may be outdated).";
      modelMsg.style.display = "block";
    } else {
      modelMsg.textContent = "Unable to load makes. Try again later or switch to VIN.";
      modelMsg.style.display = "block";
      makeSelect.disabled = true;
      modelSelect.disabled = true;
    }
  }
});

function populateMakes(names) {
  clearSelect(makeSelect, "Select make");
  names.forEach(name => {
    const opt = document.createElement("option");
    opt.value = name; opt.textContent = name;
    makeSelect.appendChild(opt);
  });
  makeSelect.disabled = false;
  modelSelect.disabled = true;
}

// ========== NHTSA: carregar modelos ==========
makeSelect.addEventListener("change", async function () {
  clearSelect(modelSelect, "Select model");
  modelMsg.style.display = "none";
  if (!this.value || !yearSelect.value) {
    modelSelect.disabled = true;
    return;
  }

  const make = this.value.trim();
  const year = yearSelect.value.trim();

  const cached = loadModelsCache(make, year, MAX_AGE);
  if (cached && cached.length) {
    populateModels(cached);
    return;
  }

  try {
    setLoading(modelSelect, true);
    const resp = await fetch(`https://vpic.nhtsa.dot.gov/api/vehicles/GetModelsForMakeYear/make/${encodeURIComponent(make)}/modelyear/${encodeURIComponent(year)}?format=json`);
    const data = await resp.json();
    const models = Array.from(new Set((data.Results || [])
      .map(m => (m.Model_Name || "").trim())
      .filter(Boolean)))
      .sort((a, b) => a.localeCompare(b));

    saveModelsCache(make, year, models);
    populateModels(models);
  } catch (e) {
    const expired = loadModelsCache(make, year, MAX_AGE, true);
    if (expired && expired.length) {
      populateModels(expired);
      modelMsg.textContent = "Unable to reach the API. Using cached models (may be outdated).";
      modelMsg.style.display = "block";
    } else {
      modelMsg.textContent = "Unable to load models. Try to use VIN instead.";
      modelMsg.style.display = "block";
      modelSelect.disabled = true;
    }
  }
});

function populateModels(models) {
  clearSelect(modelSelect, "Select model");
  models.forEach(name => {
    const opt = document.createElement("option");
    opt.value = name; opt.textContent = name;
    modelSelect.appendChild(opt);
  });
  modelSelect.disabled = false;
}

  // VALIDAR CAMPOS OBRIGAT√ìRIOS (base + VIN/Modelo)
  function validateStep() {
    document.querySelectorAll(".form-error").forEach(el => el.remove());
    const current = document.querySelector(`.form-step[data-step="${currentStep}"]`);
    const inputs = current.querySelectorAll("input[required], select[required], textarea[required]");
    for (let input of inputs) {
      if (input.type === "radio") {
        const radios = current.querySelectorAll(`input[type="radio"][name="${input.name}"]`);
        const oneChecked = Array.from(radios).some(r => r.checked);
        if (!oneChecked) {
          let lastRadio = radios[radios.length - 1];
          if (!lastRadio.nextElementSibling || !lastRadio.nextElementSibling.classList.contains('form-error')) {
            let error = document.createElement("div");
            error.className = "form-error";
            error.style.color = "#E53935";
            error.style.fontSize = "0.97em";
            error.style.marginTop = "2px";
            error.innerText = "Please, select an option.";
            lastRadio.parentNode.appendChild(error);
          }
          radios[0].focus();
          return false;
        }
      } else {
        const value = input.value.trim();

        if (!value) {
          if (!input.nextElementSibling || !input.nextElementSibling.classList.contains('form-error')) {
            let error = document.createElement("div");
            error.className = "form-error";
            error.style.color = "#E53935";
            error.style.fontSize = "0.97em";
            error.style.marginTop = "2px";
            error.innerText = "Please, fill out this field.";
            input.parentNode.appendChild(error);
          }
          input.focus();
          return false;
        }

        // NOVO: obrigar nome + sobrenome no motorista principal
        if (input.name === "main_driver_name") {
          const parts = value.split(/\s+/);
          if (parts.length < 2) {
            let error = input.parentNode.querySelector('.form-error');
            if (!error) {
              error = document.createElement("div");
              error.className = "form-error";
              error.style.color = "#E53935";
              error.style.fontSize = "0.97em";
              error.style.marginTop = "2px";
              input.parentNode.appendChild(error);
            }
            error.innerText = "You must enter both first and last name.";
            input.focus();
            return false;
          }
        }
      }
    }

    // Regras espec√≠ficas do Step 3
    const vehiclesStep = document.querySelector('.form-step[data-step="3"]');
    if (vehiclesStep && vehiclesStep.classList.contains('active')) {
      const vinMode = (document.querySelector('input[name="vin_option"]:checked') || {}).value;
      if (vinMode === 'sim') {
        if (!validateAllVINs()) return false;
      } else if (vinMode === 'nao') {
        const yearOk = !!yearSelect.value;
        const makeOk = !!makeSelect.value;
        const modelOk = !!modelSelect.value;
        if (!(yearOk && makeOk && modelOk)) {
          const error = document.createElement("div");
          error.className = "form-error";
          error.style.color = "#E53935";
          error.style.fontSize = "0.97em";
          error.style.marginTop = "2px";
          error.innerText = "Select year, make and model of the vehicle.";
          modelSection.appendChild(error);
          return false;
        }
      }
    }

    return true;
  }

  // Remove mensagem de erro ao digitar
  document.querySelectorAll("input[required], select[required], textarea[required]").forEach(function(input) {
    input.addEventListener("input", function() {
      if (input.nextElementSibling && input.nextElementSibling.classList.contains('form-error')) {
        input.nextElementSibling.remove();
      }
    });
    if (input.type === "radio") {
      input.addEventListener("change", function() {
        let radios = document.querySelectorAll(`input[type="radio"][name="${input.name}"]`);
        radios.forEach(r => {
          if (r.parentNode.querySelector('.form-error')) {
            r.parentNode.querySelector('.form-error').remove();
          }
        });
      });
    }
  });

  // Limpa erro VIN ao digitar
  document.body.addEventListener("input", function(e){
    if (e.target && (e.target.name === "vehicle_main" || e.target.name === "additional_vehicle_vin[]")) {
      const errorSpan = e.target.parentNode.querySelector('.vin-error') || document.getElementById('vin-error');
      if (errorSpan) errorSpan.style.display = "none";
    }
  }, true);

  // MOTORISTAS ADICIONAIS
  window.addAdditionalDriver = function() {
    if (driverCount >= 2) return;
    const box = document.getElementById("additionalDrivers");
    const names = Array.from(box.querySelectorAll("input[name='additional_driver_name[]']")).map(el => el.value);
    const dobs = Array.from(box.querySelectorAll("input[name='additional_driver_dob[]']")).map(el => el.value);
    const licenses = [];
    for (let i = 1; i <= names.length; i++) {
      const checked = box.querySelector(`input[name='additional_driver_license_${i}']:checked`);
      licenses.push(checked ? checked.value : "");
    }
    names.push(""); dobs.push(""); licenses.push("");
    renderAdditionalDrivers(names, dobs, licenses);
  }
  window.removeAdditionalDriver = function(index) {
    const box = document.getElementById("additionalDrivers");
    let names = Array.from(box.querySelectorAll("input[name='additional_driver_name[]']")).map(el => el.value);
    let dobs = Array.from(box.querySelectorAll("input[name='additional_driver_dob[]']")).map(el => el.value);
    let licenses = [];
    for (let i = 1; i <= names.length; i++) {
      const checked = box.querySelector(`input[name='additional_driver_license_${i}']:checked`);
      licenses.push(checked ? checked.value : "");
    }
    names.splice(index, 1); dobs.splice(index, 1); licenses.splice(index, 1);
    renderAdditionalDrivers(names, dobs, licenses);
  }
  function renderAdditionalDrivers(names, dobs, licenses) {
    const box = document.getElementById("additionalDrivers");
    box.innerHTML = "";
    for (let i = 0; i < names.length && i < 2; i++) {
      box.innerHTML += `
        <div class='form-group additional-driver-group'>
  <div class="additional-driver-block">
    <label>Additional driver name</label>
    <input type='text' name='additional_driver_name[]' value="${names[i] || ""}">
    
    <label>Date of birth</label>
    <input type='date' name='additional_driver_dob[]' value="${dobs[i] || ""}">
    
    <label>Do they have a U.S. Driver's License?</label>
    <div class="checkbox-group">
      <label><input type='radio' name='additional_driver_license_${i+1}' value='yes' ${licenses[i]==='sim'?"checked":""} required> Yes</label>
      <label><input type='radio' name='additional_driver_license_${i+1}' value='no' ${licenses[i]==='nao'?"checked":""} required> No</label>
    </div>
  </div>

  <div class="remove-driver-area">
    <button type="button" onclick="removeAdditionalDriver(${i})" class="remove-adicional-btn" aria-label="Remove additional driver">
      <span>Remove driver</span> <span class="x-ico">x</span>
    </button>
  </div>
</div>

      `;
    }
    driverCount = names.length;
  }

  // VE√çCULOS ADICIONAIS
  window.addAdditionalVehicle = function() {
    if (vehicleCount >= 2) return;
    const box = document.getElementById("additionalVehicles");
    const vins = Array.from(box.querySelectorAll("input[name='additional_vehicle_vin[]']")).map(el => el.value);
    vins.push("");
    renderAdditionalVehicles(vins);
  }
  window.removeAdditionalVehicle = function(index) {
    const box = document.getElementById("additionalVehicles");
    let vins = Array.from(box.querySelectorAll("input[name='additional_vehicle_vin[]']")).map(el => el.value);
    vins.splice(index, 1);
    renderAdditionalVehicles(vins);
  }
  function renderAdditionalVehicles(vins) {
    const box = document.getElementById("additionalVehicles");
    box.innerHTML = "";
    for (let i = 0; i < vins.length && i < 2; i++) {
      box.innerHTML += `
       <div class='form-group additional-vehicle-group'>
  <div class="additional-vehicle-block">
    <label>Additional vehicle VIN</label>
    <input type='text' name='additional_vehicle_vin[]' value="${vins[i] || ""}" maxlength="17" autocomplete="off">
    <span class="vin-error" style="display:none;color:#E53935;font-size:0.97em;margin-top:2px;"></span>
  </div>

  <div class="remove-vehicle-area">
    <button type="button" onclick="removeAdditionalVehicle(${i})" class="remove-adicional-btn" aria-label="Remove additional vehicle">
      <span>Remove vehicle</span> <span class="x-ico">x</span>
    </button>
  </div>
</div>

      `;
    }
    vehicleCount = vins.length;
  }

// SUMMARY DISPLAY (VIN/Model)
window.showSummary = function() {
  if (!validateStep()) return;
  const summary = document.getElementById("summaryBox");
  const form = document.getElementById("autoForm");
  const formData = new FormData(form);
  let text = "";

  text += `<strong>State:</strong> ${formData.get("state") || ""}<br>`;
  text += `<strong>Main driver's name:</strong> ${formData.get("main_driver_name") || ""}<br>`;
  text += `<strong>Date of birth:</strong> ${formData.get("main_driver_dob") || ""}<br>`;
  text += `<strong>ZIP Code:</strong> ${formData.get("zip") || ""}<br>`;
  text += `<strong>Full address:</strong> ${formData.get("address") || ""}<br>`;
  text += `<strong>Phone:</strong> ${formData.get("phone") || ""}<br>`;
  text += `<strong>Has Driver's License:</strong> ${formData.get("has_license") || ""}<br>`;

  const additionalNames = formData.getAll("additional_driver_name[]");
  const additionalDOBs = formData.getAll("additional_driver_dob[]");
  let additionalLicenses = [];
  for (let i = 1; i <= additionalNames.length; i++) {
    additionalLicenses.push(formData.get(`additional_driver_license_${i}`));
  }

  let additionalDrivers = [];
  for (let i = 0; i < additionalNames.length; i++) {
    let info = [];
    if (additionalNames[i]) info.push(additionalNames[i]);
    if (additionalDOBs[i]) info.push(additionalDOBs[i]);
    if (additionalLicenses[i]) info.push(additionalLicenses[i]);
    if (info.length) additionalDrivers.push(info.join(", "));
  }

  if (additionalDrivers.length > 0) {
    text += `<strong>Additional drivers:</strong> ${additionalDrivers.join(" | ")}<br>`;
  }

  const vinMode = formData.get("vin_option");
  if (vinMode === "sim") {
    text += `<strong>Main vehicle (VIN):</strong> ${formData.get("vehicle_main") || ""}<br>`;
  } else {
    const y = formData.get("vehicle_year") || "";
    const mk = formData.get("vehicle_make") || "";
    const md = formData.get("vehicle_model") || "";
    text += `<strong>Main vehicle:</strong> ${[y, mk, md].filter(Boolean).join(" ")}<br>`;
  }

  const vehiclesAdd = formData.getAll("additional_vehicle_vin[]").filter(v => v && v.trim() !== "");
  if (vehiclesAdd.length > 0) {
    text += `<strong>Additional vehicles (VINs):</strong> ${vehiclesAdd.join(", ")}<br>`;
  }

  text += `<strong>Currently has auto insurance?:</strong> ${formData.get("has_insurance") || ""}<br>`;
  text += `<strong>Email:</strong> ${formData.get("email") || ""}<br>`;

  summary.innerHTML = text;
  nextStep();
}


  // ========= ENVIO FINAL =========
  document.getElementById("autoForm").addEventListener("submit", async function(e) {
    e.preventDefault();
    const form = e.target;
    const formData = new FormData(form);

    // bot√£o de submit
    const submitBtn = document.getElementById('submitBtn');
    if (submitBtn) {
      submitBtn.disabled = true;
      submitBtn.dataset.originalText = submitBtn.dataset.originalText || submitBtn.textContent;
      submitBtn.textContent = 'Sending...';
    }

    function toMMDDYYYY(date) {
      if (!date) return "";
      const [yyyy, mm, dd] = date.split("-");
      return `${mm}/${dd}/${yyyy}`;
    }

    // NOME PRINCIPAL (sem Jo√£o / Silva)
    const fullNameRaw = (formData.get("main_driver_name") || "").trim();
    let mainFirst = "";
    let mainLast = "";

    if (fullNameRaw) {
      const parts = fullNameRaw.split(/\s+/);
      mainFirst = parts.shift() || "";
      mainLast  = parts.join(" ");
    }

    // E-MAIL E TELEFONE REAIS DO USU√ÅRIO
    const userEmail = (formData.get("email") || "").trim();
    let userPhone  = (formData.get("phone") || "").trim();
    if (typeof itiInstance !== "undefined" && itiInstance && typeof itiInstance.getNumber === "function") {
      const fullNumber = itiInstance.getNumber();
      if (fullNumber) userPhone = fullNumber;
    }

    // DRIVERS
    const drivers = [{
      first_name: mainFirst,
      last_name: mainLast,
      date_of_birth: toMMDDYYYY(formData.get("main_driver_dob")),
      gender: "male",
      marital_status: "S",
      relationship: "Self",
      years_licensed: "3"
    }];

    const additionalNames = formData.getAll("additional_driver_name[]");
    const additionalDOBs  = formData.getAll("additional_driver_dob[]");

    additionalNames.forEach((name, i) => {
      const nameTrim = (name || "").trim();
      if (nameTrim) {
        const parts = nameTrim.split(/\s+/);
        const first = parts.shift() || "";
        const last  = parts.join(" ");
        drivers.push({
          first_name: first,
          last_name: last,
          date_of_birth: toMMDDYYYY(additionalDOBs[i]),
          gender: "male",
          marital_status: "S",
          relationship: "Other",
          years_licensed: "3"
        });
      }
    });

    // VE√çCULOS (VIN OU MODELO)
    const vinMode = formData.get("vin_option");
    const vehicles = [];

    if (vinMode === "sim") {
      const mainVIN = (formData.get("vehicle_main") || "").trim();
      if (mainVIN) {
        vehicles.push({ vin: mainVIN, ownership_status: "financed" });
      }
    } else {
      const y  = (formData.get("vehicle_year")  || "").trim();
      const mk = (formData.get("vehicle_make") || "").trim();
      const md = (formData.get("vehicle_model")|| "").trim();
      if (y && mk && md) {
        vehicles.push({ year: y, make: mk, model: md, ownership_status: "financed" });
      }
    }

    // VINs adicionais
    const vinExtras = formData.getAll("additional_vehicle_vin[]");
    vinExtras.forEach(vin => {
      const cleanVin = (vin || "").trim();
      if (cleanVin) {
        vehicles.push({ vin: cleanVin, ownership_status: "financed" });
      }
    });

    // LARA PAYLOAD (sem Kamili, sem senha/telefone fixos)
    const laraPayload = {
      personal_info: {
        first_name: mainFirst,
        last_name: mainLast,
        date_of_birth: toMMDDYYYY(formData.get("main_driver_dob")),
        marital_status: "S"
      },
      address_info: {
        address_line1: formData.get("address") || "",
        address_line2: "",
        zipcode: formData.get("zip") || "",
        apartment_type: "apartment",
        rental_status: "rental",
        address_time: "4"
      },
      contact_info: {
        email: userEmail,
        cellphone: userPhone
      },
      vehicles: vehicles.length ? vehicles : [],
      drivers:  drivers.length  ? drivers  : [],
      insurance_info: {
        effective_date: "today",
        credit_check_authorized: "yes",
        expiration_date: "today"
      },
      quote_info: {
        number_of_cars: vehicles.length || 1,
        number_of_additional_drivers: additionalNames.length || 0,
        homeowner_policy_by_agency: "no",
        enroll_in_snapshot: "no"
      },
      auto_quote_settings: {
        template_type: "auto_quote_stand"
      },
      system_settings: {
        wait_time: 2,
        timeout: 20
      },
      headless: true
    };

    // NOVO: URL da p√°gina para identificar a origem do formul√°rio
    const currentUrl = window.location.href;

    try {
      await fetch("https://primary-production-2441.up.railway.app/webhook/217cc570-0486-40a3-acd6-5f699556cca5/lara-selenium", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          ...laraPayload,
          user_email: userEmail,
          page_url: currentUrl
        })
      });

      showSuccessModal();
      form.reset();

      if (typeof fbq === "function") {
        fbq('trackCustom', 'CotacaoEnviada');
        fbq('track', 'Lead');
        console.log('Pixel: CotacaoEnviada + Lead');
      }

      setTimeout(() => { location.reload(); }, 8000);
    } catch (err) {
      alert("Erro ao enviar dados. Tente novamente!");
      if (submitBtn) {
        submitBtn.disabled = false;
        submitBtn.textContent = submitBtn.dataset.originalText || 'Enviar Cota√ß√£o';
      }
    }
  });

  // MODAL SUCESSO
  let modalTimeout = null;
  window.showSuccessModal = function() {
    document.getElementById('modal-success').style.display = 'flex';
    document.body.style.overflow = 'hidden';
    clearTimeout(modalTimeout);
    modalTimeout = setTimeout(closeSuccessModal, 8000);
  }
  window.closeSuccessModal = function() {
    document.getElementById('modal-success').style.display = 'none';
    document.body.style.overflow = '';
    clearTimeout(modalTimeout);
  }
});


document.addEventListener('DOMContentLoaded', function() {
  function removeAcentos(str) {
    return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^A-Za-z\s.]/g, "");
  }

  document.querySelectorAll('input[name="main_driver_name"], input[name="additional_driver_name[]"]').forEach(function(nomeInput) {
    nomeInput.addEventListener('input', function() {
      var val = removeAcentos(nomeInput.value);
      nomeInput.value = val;
    });
  });

  // Monitorar campos adicionais criados dinamicamente
  var observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      mutation.addedNodes.forEach(function(node) {
        if (node.nodeType === 1) {
          var newNomeInputs = node.querySelectorAll && node.querySelectorAll('input[name="additional_driver_name[]"]');
          if (newNomeInputs && newNomeInputs.length) {
            newNomeInputs.forEach(function(input) {
              input.addEventListener('input', function() {
                var val = removeAcentos(input.value);
                input.value = val;
              });
            });
          }
        }
      });
    });
  });
  observer.observe(document.body, { childList: true, subtree: true });

  // Limitar tamanho do input de data
  document.querySelectorAll('input[name="main_driver_dob"], input[name="additional_driver_dob[]"]').forEach(function(dobInput) {
    dobInput.addEventListener('input', function() {
      if (dobInput.value.length > 10) dobInput.value = dobInput.value.slice(0,10);
    });
  });
});

document.addEventListener("DOMContentLoaded", function() {
  const zipInput = document.getElementById("zip");
  const stateInput = document.getElementById("state");
  const addressInput = document.getElementById("address");

  // AUTOCOMPLETE ENDERE√áO
  let autocomplete = new google.maps.places.Autocomplete(addressInput, {
    types: ['address'],
    componentRestrictions: { country: "us" }
  });

  autocomplete.addListener('place_changed', function () {
    let place = autocomplete.getPlace();
    let zip = "", state = "";
    if (place.address_components) {
      place.address_components.forEach(comp => {
        if (comp.types.includes("postal_code")) zip = comp.long_name;
        if (comp.types.includes("administrative_area_level_1")) state = comp.short_name;
      });
      if (zip) zipInput.value = zip;
      if (state) stateInput.value = state;
    }
  });

  // GEOCODER PELO ZIP CODE
  function getAddressByZip(zipCode) {
    let geocoder = new google.maps.Geocoder();
    geocoder.geocode({ 'address': zipCode }, function(results, status) {
      if (status === 'OK' && results[0]) {
        let state = "";
        results[0].address_components.forEach(comp => {
          if (comp.types.includes("administrative_area_level_1")) {
            state = comp.long_name;
          }
        });
        if (state) stateInput.value = state;
      }
    });
  }

  zipInput.addEventListener("blur", function() {
    if (zipInput.value.trim() !== "") {
      getAddressByZip(zipInput.value.trim());
    }
  });
});

document.addEventListener('DOMContentLoaded', function () {
  const allIcons = document.querySelectorAll('.help-icon');
  const allTips  = document.querySelectorAll('.tooltip-pop');

  function closeAllTips() {
    allIcons.forEach(btn => btn.setAttribute('aria-expanded', 'false'));
    allTips.forEach(tp => { tp.dataset.open = 'false'; tp.setAttribute('aria-hidden','true'); });
  }

  allIcons.forEach(btn => {
    btn.addEventListener('click', function (ev) {
      ev.preventDefault();
      ev.stopPropagation();

      const tipId = btn.getAttribute('aria-controls');
      const tip   = document.getElementById(tipId);
      const isOpen = tip?.dataset.open === 'true';

      closeAllTips();
      if (!isOpen && tip) {
        tip.dataset.open = 'true';
        tip.setAttribute('aria-hidden','false');
        btn.setAttribute('aria-expanded','true');
      }
    });
  });

  document.addEventListener('click', closeAllTips);
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeAllTips();
  });
});



  </script>>
</body>
</html>
